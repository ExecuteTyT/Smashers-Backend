# Следующие шаги - Отладка парсеров

## Текущая ситуация

✅ **Что работает:**
- PostgreSQL развернута на сервере `185.218.19.19:5432`
- Таблицы созданы через Prisma
- Категории (7) и локации (10) успешно парсятся
- Данные сохраняются в удаленную БД

❌ **Что не работает:**
- Абонементы (memberships) - 0 записей
- Тренировки (sessions) - 0 записей

## Шаг 1: Установить зависимости

```powershell
cd smashers-backend
npm install
```

Это установит `dotenv` и другие зависимости.

## Шаг 2: Отладить парсер абонементов

```powershell
node scripts/debug-parser.js memberships
```

**Что произойдет:**
1. Скрипт подключится к Django админке
2. Откроет страницу `/admin/core/abik/`
3. Сохранит скриншот в `debug/memberships-screenshot.png`
4. Сохранит HTML в `debug/memberships-page.html`
5. Выведет информацию о структуре таблицы

**Что проверить:**
- Есть ли таблица на странице?
- Какой селектор у таблицы?
- Есть ли данные в таблице?

## Шаг 3: Отладить парсер тренировок

```powershell
node scripts/debug-parser.js sessions
```

Аналогично создаст файлы в `debug/sessions-*`.

## Шаг 4: Анализ результатов

После выполнения скриптов проверьте:

### 1. Скриншоты
Откройте `debug/memberships-screenshot.png и посмотрите:
- Есть ли таблица на странице?
- Как она выглядит?
- Есть ли данные?

### 2. HTML файлы
Откройте `debug/memberships-page.html` в браузере и проверьте:
- Структуру страницы
- Селекторы таблиц
- Наличие данных

### 3. Консольный вывод
В выводе скрипта будет информация:
- Найден ли `#result_list`
- Количество строк в таблице
- Структура таблицы

## Шаг 5: Исправление парсеров

На основе результатов отладки:

### Если таблица не найдена:
1. Проверьте URL в Django админке вручную
2. Возможно, URL отличается от `/core/abik/` или `/core/session/`
3. Обновите URL в парсерах

### Если таблица найдена, но пустая:
1. Проверьте, есть ли данные в Django админке
2. Возможно, нужно добавить данные вручную

### Если структура таблицы отличается:
1. Изучите HTML файл
2. Обновите селекторы в парсерах
3. Адаптируйте логику парсинга

## Шаг 6: Повторный запуск парсера

После исправления парсеров:

```powershell
npm run parse
```

Проверьте логи:
- Должно быть: `Parsed X memberships` (где X > 0)
- Должно быть: `Parsed X sessions total` (где X > 0)

## Шаг 7: Проверка данных в БД

```powershell
# Через Prisma Studio (GUI)
npm run studio
# Откроется на http://localhost:5555

# Или через API
# Запустите сервер (если еще не запущен)
npm run dev

# В другом терминале проверьте API
curl http://localhost:3000/api/memberships
curl http://localhost:3000/api/locations
```

## Возможные проблемы и решения

### Проблема: Скрипт не запускается
**Решение:** Убедитесь, что установлены все зависимости:
```powershell
npm install
```

### Проблема: Ошибка подключения к Django
**Решение:** Проверьте в `.env`:
- `DJANGO_URL` - правильный ли URL?
- `DJANGO_USERNAME` - правильный ли логин?
- `DJANGO_PASSWORD` - правильный ли пароль?

### Проблема: Таблица не найдена
**Решение:** 
1. Откройте Django админку вручную в браузере
2. Проверьте URL страницы с абонементами/тренировками
3. Возможно, URL отличается от ожидаемого

### Проблема: Таблица найдена, но пустая
**Решение:**
1. Проверьте, есть ли данные в Django админке
2. Возможно, нужно добавить тестовые данные

## Чек-лист

- [ ] Зависимости установлены (`npm install`)
- [ ] Скрипт отладки для memberships выполнен
- [ ] Скрипт отладки для sessions выполнен
- [ ] Скриншоты и HTML файлы созданы
- [ ] Проанализированы результаты отладки
- [ ] Парсеры исправлены (если нужно)
- [ ] Парсер запущен повторно (`npm run parse`)
- [ ] Данные проверены в БД (Prisma Studio или API)

## После успешного парсинга

Когда парсеры заработают:

1. ✅ Данные будут в БД
2. ⏭️ Настроить cron job для автоматического парсинга
3. ⏭️ Запустить API сервер
4. ⏭️ Протестировать API endpoints

---

**Важно:** Все команды выполняются **локально**, данные сохраняются в **удаленную БД** на сервере.

# План проверки после запуска парсера

## Цель

После запуска парсера нужно проверить:
1. Какие данные реально приходят из Django
2. Соответствуют ли они структуре API
3. Нужны ли дополнительные эндпоинты или фильтры

## Шаги проверки

### 1. Запуск парсера

```bash
# Из директории smashers-backend
npm run parse
```

Или через API (если сервер запущен):
```bash
POST /api/trigger-parse
Headers: X-API-Key: your_api_key
```

### 2. Проверка данных в базе

После парсинга проверить данные через Prisma Studio:
```bash
npm run studio
```

Или через прямые SQL запросы к БД.

### 3. Проверка через API эндпоинты

#### 3.1. Категории
```bash
GET /api/categories
```
**Проверить:**
- [ ] Все категории парсятся корректно
- [ ] Поле `isVisible` работает правильно
- [ ] Поле `sortOrder` есть и используется
- [ ] Нет лишних/неожиданных полей

#### 3.2. Абонементы
```bash
GET /api/memberships
GET /api/memberships/2
GET /api/memberships/by-type/Обычный абик
GET /api/memberships/by-type/Подарочный серт
```
**Проверить:**
- [ ] Все абонементы парсятся
- [ ] Абонемент с id=2 существует и имеет цену 1200 руб
- [ ] Поле `isVisible` работает правильно
- [ ] Типы абонементов корректны ("Обычный абик", "Подарочный серт")
- [ ] Поля `price`, `sessionCount` заполнены
- [ ] Нет лишних/неожиданных полей

#### 3.3. Локации
```bash
GET /api/locations
GET /api/locations/1
GET /api/locations/1/sessions
```
**Проверить:**
- [ ] Все локации парсятся
- [ ] Поля `showLocation` и `showOnBookingScreen` работают правильно
- [ ] Поле `description` заполнено (если есть)
- [ ] Поле `sortOrder` есть и используется
- [ ] Фильтрация по видимости работает корректно
- [ ] Нет лишних/неожиданных полей

#### 3.4. Тренировки
```bash
GET /api/sessions
GET /api/sessions?date=2024-01-30
GET /api/sessions?category_id=1&location_id=1
GET /api/sessions?available_only=true
GET /api/sessions/upcoming
GET /api/sessions/1
```
**Проверить:**
- [ ] Все тренировки парсятся
- [ ] Поле `status` корректно (должно быть "Активно" для активных)
- [ ] Поля `datetime`, `locationId`, `categoryId` заполнены
- [ ] Поля `maxSpots`, `availableSpots` заполнены
- [ ] Поле `trainers` заполнено
- [ ] Поле `name` заполнено
- [ ] Связи с `category` и `location` работают
- [ ] Фильтры работают корректно
- [ ] Нет лишних/неожиданных полей

### 4. Проверка структуры данных

#### 4.1. Сравнение с Prisma схемой

Проверить, что все поля из схемы заполняются:
- [x] Category: `id`, `name`, `sortOrder`, `isVisible`, `lastUpdated`
- [x] Membership: `id`, `name`, `type`, `price`, `sessionCount`, `isVisible`, `lastUpdated`
- [x] Location: `id`, `name`, `showLocation`, `showOnBookingScreen`, `description`, `sortOrder`, `lastUpdated`
- [x] Session: `id`, `datetime`, `locationId`, `trainers`, `name`, `categoryId`, `maxSpots`, `availableSpots`, `status`, `lastUpdated`

#### 4.2. Проверка неожиданных полей

Если в Django есть дополнительные поля, которые не парсятся, но могут понадобиться:
- [ ] Есть ли поля, которые нужно добавить в схему?
- [ ] Есть ли данные, которые нужно парсить, но не парсятся?

### 5. Проверка фильтрации

#### 5.1. По видимости
- [ ] Категории: только `isVisible: true` возвращаются через `/api/categories`
- [ ] Абонементы: только `isVisible: true` возвращаются через `/api/memberships`
- [ ] Локации: только `showLocation: true` И `showOnBookingScreen: true` через `/api/locations`
- [ ] Тренировки: только `status: 'Активно'` через `/api/sessions`

#### 5.2. По дате
- [ ] Фильтр `date` работает (конкретная дата)
- [ ] Фильтр `date_from` и `date_to` работают (диапазон)
- [ ] `upcoming` возвращает только будущие тренировки

#### 5.3. По связям
- [ ] `category_id` фильтрует тренировки
- [ ] `location_id` фильтрует тренировки
- [ ] `available_only` фильтрует по доступным местам

### 6. Проверка специальных случаев

#### 6.1. Разовая тренировка
- [ ] Абонемент с id=2 существует
- [ ] Цена = 1200 руб
- [ ] Доступен через `/api/memberships/2` даже если невидимый

#### 6.2. Пустые данные
- [ ] Что происходит, если нет категорий?
- [ ] Что происходит, если нет абонементов?
- [ ] Что происходит, если нет локаций?
- [ ] Что происходит, если нет тренировок?

### 7. Выявление пробелов

После проверки ответить на вопросы:

#### 7.1. Нужны ли дополнительные эндпоинты?
- [ ] Нужен ли эндпоинт для получения категории с сессиями? (есть `/api/categories/:id`, но можно проверить)
- [ ] Нужен ли эндпоинт для группировки тренировок по датам?
- [ ] Нужен ли эндпоинт для статистики (количество свободных мест, популярные локации)?

#### 7.2. Нужны ли дополнительные фильтры?
- [ ] Фильтр по тренеру (`trainers`)?
- [ ] Фильтр по типу абонемента (уже есть `/api/memberships/by-type/:type`)?
- [ ] Фильтр по диапазону цен абонементов?
- [ ] Фильтр по количеству тренировок в абонементе?

#### 7.3. Нужны ли дополнительные поля в ответах?
- [ ] Нужно ли включать количество тренировок в категории?
- [ ] Нужно ли включать количество свободных мест в локации?
- [ ] Нужно ли включать ближайшую тренировку в категории/локации?

### 8. Документирование результатов

После проверки создать документ с результатами:
- Какие данные реально приходят
- Какие поля заполнены/пустые
- Какие неожиданные данные обнаружены
- Какие дополнительные эндпоинты нужны (если нужны)

## Чек-лист после парсинга

- [ ] Парсер запущен успешно
- [ ] Данные сохранены в БД
- [ ] Все API эндпоинты возвращают данные
- [ ] Фильтрация работает корректно
- [ ] Специальные случаи обработаны (разовая тренировка id=2)
- [ ] Нет ошибок при запросах
- [ ] Структура данных соответствует ожиданиям
- [ ] Выявлены пробелы (если есть)
- [ ] Документация обновлена (если нужно)

## Команды для быстрой проверки

```bash
# Проверка через curl (если сервер запущен на localhost:3000)
curl http://localhost:3000/api/categories
curl http://localhost:3000/api/memberships
curl http://localhost:3000/api/memberships/2
curl http://localhost:3000/api/locations
curl http://localhost:3000/api/sessions
curl http://localhost:3000/api/sessions/upcoming
```

## Ожидаемые результаты

После успешного парсинга должны быть доступны:
- ✅ Категории (минимум 1-2)
- ✅ Абонементы (минимум несколько, включая id=2)
- ✅ Локации (минимум несколько)
- ✅ Тренировки (может быть много, зависит от данных в Django)

Если что-то отсутствует или работает не так, как ожидается - это нужно документировать и исправить.
